<footer class="bg-light dark:bg-darkmode-light">
  <div class="container">
    <!-- Newsletter 订阅表单开始 -->
    {{ if site.Params.newsletter.enable }}
    <div class="row justify-center border-border dark:border-darkmode-border border-b py-10">
      <div class="lg:col-6 text-center">
        <!-- 订阅标题 -->
        <h2 class="h3 mb-4">{{ site.Params.newsletter.title | markdownify }}</h2>
        <!-- 订阅描述 -->
        <p class="mb-8">{{ site.Params.newsletter.description | markdownify }}</p>
        <!-- 订阅表单，支持 Buttondown 弹出窗口 -->
        <form id="newsletter-footer" action="{{ site.Params.newsletter.action }}" method="post" onsubmit="handleNewsletterSubmit(event, this)" class="flex flex-col sm:flex-row gap-4 justify-center relative">
        <input type="email" name="email" class="form-input w-full sm:w-auto min-w-[300px] rounded" placeholder="{{ site.Params.newsletter.placeholder }}" required>
        <button type="submit" class="btn btn-primary">
          <span class="submit-text">{{ site.Params.newsletter.button_label }}</span>
          <span class="loading-text hidden">提交中...</span>
        </button>
        <div id="newsletter-footer-success" class="hidden absolute -bottom-8 left-0 right-0 text-green-500 text-sm">
          感谢订阅！请检查您的邮箱以确认。
        </div>
        <div id="newsletter-footer-error" class="hidden absolute -bottom-8 left-0 right-0 text-red-500 text-sm">
          订阅失败，请稍后重试。
        </div>
      </form>

      <script>
        async function handleNewsletterSubmit(event, form) {
          event.preventDefault();
          const email = form.querySelector('input[name="email"]').value;
          const submitBtn = form.querySelector('button[type="submit"]');
          const submitText = submitBtn.querySelector('.submit-text');
          const loadingText = submitBtn.querySelector('.loading-text');
          const successDiv = document.getElementById(form.id + '-success');
          const errorDiv = document.getElementById(form.id + '-error');

          // 重置状态
          successDiv.classList.add('hidden');
          errorDiv.classList.add('hidden');
          submitBtn.disabled = true;
          submitText.classList.add('hidden');
          loadingText.classList.remove('hidden');

          try {
            const response = await fetch('{{ site.Params.newsletter.action }}', {
              method: 'POST',
              headers: {
                'Authorization': 'Token {{ site.Params.newsletter.api_token }}',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                email_address: email,
                tags: ['newsletter']
              })
            });

            if (response.ok) {
              successDiv.classList.remove('hidden');
              form.reset();
            } else {
              const data = await response.json();
              errorDiv.innerText = data.detail || '订阅失败，请稍后重试。';
              errorDiv.classList.remove('hidden');
            }
          } catch (err) {
            errorDiv.classList.remove('hidden');
            console.error('Newsletter error:', err);
          } finally {
            submitBtn.disabled = false;
            submitText.classList.remove('hidden');
            loadingText.classList.add('hidden');
            setTimeout(() => {
              successDiv.classList.add('hidden');
              errorDiv.classList.add('hidden');
            }, 5000);
          }
        }
      </script>
      </div>
    </div>
    {{ end }}
    <!-- Newsletter 订阅表单结束 -->
    <div class="row items-center py-10">
      <div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left">
        <!-- navbar brand/logo -->
        <a
          class="navbar-brand inline-block"
          href="{{ site.Home.RelPermalink }}">
          {{/* https://github.com/gethugothemes/hugo-modules/tree/master/images */}}
          {{ partial "logo" }}
        </a>
      </div>
      <div class="lg:col-6 mb-8 text-center lg:mb-0">
        <ul>
          {{ range site.Menus.footer }}
            <li class="m-3 inline-block">
              <a
                {{ if findRE `^http` .URL }}
                  target="_blank" rel="noopener"
                {{ end }}
                href="{{ if findRE `^#` .URL }}
                  {{ if not $.IsHome }}
                    {{ site.Home.RelPermalink }}
                  {{ end }}{{ .URL }}
                {{ else }}
                  {{ .URL | relLangURL }}
                {{ end }}"
                >{{ .Name }}</a
              >
            </li>
          {{ end }}
        </ul>
      </div>
      <div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right">
        <ul class="social-icons">
          {{ range site.Data.social.main }}
            <li>
              <a
                target="_blank"
                aria-label="{{ .name }}"
                rel="nofollow noopener"
                href="{{ .link | safeURL }}">
                <i class="{{ .icon }}"></i>
              </a>
            </li>
          {{ end }}
        </ul>
      </div>
    </div>
  </div>
  <div class="border-border dark:border-darkmode-border border-t py-7">
    <div
      class="text-text-light dark:text-darkmode-text-light container text-center">
      <p>
        {{ site.Params.copyright | markdownify }}
      </p>
    </div>
  </div>
</footer>
